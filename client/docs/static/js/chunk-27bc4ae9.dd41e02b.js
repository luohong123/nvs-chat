(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27bc4ae9"],{1561:function(t,e,s){"use strict";var a=s("c213"),n=s.n(a);n.a},"158e":function(t,e,s){},"15da":function(t,e,s){"use strict";var a=s("efb1"),n=s.n(a);n.a},"1dde":function(t,e,s){var a=s("d039"),n=s("b622"),i=s("60ae"),o=n("species");t.exports=function(t){return i>=51||!a((function(){var e=[],s=e.constructor={};return s[o]=function(){return{foo:1}},1!==e[t](Boolean).foo}))}},"466d":function(t,e,s){"use strict";var a=s("d784"),n=s("825a"),i=s("50c4"),o=s("1d80"),c=s("8aa5"),r=s("14c3");a("match",1,(function(t,e,s){return[function(e){var s=o(this),a=void 0==e?void 0:e[t];return void 0!==a?a.call(e,s):new RegExp(e)[t](String(s))},function(t){var a=s(e,t,this);if(a.done)return a.value;var o=n(t),l=String(this);if(!o.global)return r(o,l);var u=o.unicode;o.lastIndex=0;var d,h=[],f=0;while(null!==(d=r(o,l))){var m=String(d[0]);h[f]=m,""===m&&(o.lastIndex=c(l,i(o.lastIndex),u)),f++}return 0===f?null:h}]}))},"478d":function(t,e,s){},"4de4":function(t,e,s){"use strict";var a=s("23e7"),n=s("b727").filter,i=s("1dde");a({target:"Array",proto:!0,forced:!i("filter")},{filter:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}})},"65f0":function(t,e,s){var a=s("861d"),n=s("e8b5"),i=s("b622"),o=i("species");t.exports=function(t,e){var s;return n(t)&&(s=t.constructor,"function"!=typeof s||s!==Array&&!n(s.prototype)?a(s)&&(s=s[o],null===s&&(s=void 0)):s=void 0),new(void 0===s?Array:s)(0===e?0:e)}},9426:function(t,e,s){"use strict";var a=s("158e"),n=s.n(a);n.a},b727:function(t,e,s){var a=s("f8c2"),n=s("44ad"),i=s("7b0b"),o=s("50c4"),c=s("65f0"),r=[].push,l=function(t){var e=1==t,s=2==t,l=3==t,u=4==t,d=6==t,h=5==t||d;return function(f,m,g,p){for(var v,E,C=i(f),I=n(C),b=a(m,g,3),O=o(I.length),T=0,R=p||c,A=e?R(f,O):s?R(f,0):void 0;O>T;T++)if((h||T in I)&&(v=I[T],E=b(v,T,C),t))if(e)A[T]=E;else if(E)switch(t){case 3:return!0;case 5:return v;case 6:return T;case 2:r.call(A,v)}else if(u)return!1;return d?-1:l||u?u:A}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6)}},c213:function(t,e,s){},c5e8:function(t,e,s){},d345:function(t,e,s){},d655:function(t,e,s){"use strict";var a=s("478d"),n=s.n(a);n.a},d800:function(t,e,s){"use strict";s.d(e,"f",(function(){return n})),s.d(e,"e",(function(){return i})),s.d(e,"b",(function(){return o})),s.d(e,"a",(function(){return c})),s.d(e,"c",(function(){return r})),s.d(e,"d",(function(){return l}));var a=s("b775");function n(t){return Object(a["a"])({url:"/messageList",method:"get",params:{userId:t}})}function i(t){return Object(a["a"])({url:"/message/create",method:"post",data:t})}function o(){return Object(a["a"])({url:"/groupinfo/list",method:"get"})}function c(t){return Object(a["a"])({url:"/groupinfo/detail",method:"get",params:{groupId:t}})}function r(t){return Object(a["a"])({url:"/groupuser/list",method:"get",params:{groupId:t}})}function l(t){return Object(a["a"])({url:"/groupInfo/create",method:"post",data:t})}},d840:function(t,e,s){"use strict";var a=s("d345"),n=s.n(a);n.a},e445:function(t,e,s){"use strict";var a=s("c5e8"),n=s.n(a);n.a},e8b5:function(t,e,s){var a=s("c6b6");t.exports=Array.isArray||function(t){return"Array"==a(t)}},efb1:function(t,e,s){},f7c1:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chatDetail"},[s("div",{staticClass:"left"},[t.userName&&"undefined"!==t.userName?s("div",{staticClass:"searchbar-wrap"},[s("searchbar"),s("div",{staticClass:"action-add"},[s("a-icon",{attrs:{type:"plus-square"},on:{click:t.groupAddModal}})],1)],1):t._e(),s("listitem",{staticClass:"left-list",attrs:{list:t.list}})],1),s("div",{staticClass:"right"},[s("headerbar",{ref:"headerbar",attrs:{title:t.title},on:{toggle:t.toggle}}),s("chat",{staticClass:"chat-wrap",attrs:{list:t.historyChats}}),s("div",{staticClass:"more-introduce",class:{show:t.isOpen}},[s("managepanel",{attrs:{group:t.groupInfo,list:t.groupUsers}})],1)],1),s("a-modal",{attrs:{title:"创建群聊",visible:t.groupVisible,confirmLoading:t.groupConfirmLoading},on:{ok:t.groupInfoAdd,cancel:t.groupCancel}},[s("div",[s("p",[t._v("请输入群聊名称")]),s("a-input",{model:{value:t.groupName,callback:function(e){t.groupName=e},expression:"groupName"}})],1)])],1)},n=[],i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat"},[s("ul",{staticClass:"message-list"},t._l(t.list,(function(e){return s("li",{key:e.MESSAGEID,staticClass:"chat-item"},[s("p",{staticClass:"time-show"},[s("span",{staticClass:"time"},[t._v(t._s(e.TIME))])]),e.USERNAME!==t.userName?s("div",{staticClass:"chat-conversation them"},[s("img",{staticClass:"avatar",attrs:{src:e.AVATAR,alt:""}}),s("div",{staticClass:"chat-message"},[s("span",{staticClass:"chat-user"},[t._v(t._s(e.USERNAME))]),s("div",{staticClass:"chat-popover"},[t._v(t._s(e.CONTENT))])])]):t._e(),e.USERNAME===t.userName?s("div",{staticClass:"chat-conversation me"},[s("div",{staticClass:"chat-message"},[s("div",{staticClass:"chat-popover"},[t._v(t._s(e.CONTENT))])]),s("img",{staticClass:"avatar",attrs:{src:e.AVATAR,alt:""}})]):t._e()])})),0),t.userName&&"undefined"!==t.userName?s("div",{staticClass:"sendMessage"},[t._m(0),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"message-control",attrs:{rows:"3",cols:"20"},domProps:{value:t.message},on:{input:[function(e){e.target.composing||(t.message=e.target.value)},t.watchInput],keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)}}}),s("div",{staticClass:"send-control"},[t.showTips?s("div",{staticClass:"popover"},[s("div",{staticClass:"tips"},[t._v(t._s(t.tips))])]):t._e(),s("button",{staticClass:"btn btn-primary",attrs:{type:"submit"},on:{click:t.sendMessage}},[t._v(" 发送(S) ")])])]):t._e(),t.userName&&"undefined"!==t.userName?t._e():s("div",{staticClass:"dontSend"},[t._v(" 您现在是游客身份,请"),s("a",{staticClass:"link",on:{click:t.sigin}},[t._v("登录")]),t._v("后一起参与讨论吧！ ")])])},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"message-toolbar"},[s("div",{staticClass:"message-toolbar-left"}),s("div",{staticClass:"message-toolbar-left"})])}],c=(s("ac1f"),s("466d"),s("ed08")),r=s("2b0e"),l=new r["a"],u={name:"Chat",props:{list:Array},data:function(){return{userInfo:Object(c["d"])(),userName:Object(c["e"])(),chatContent:{},message:"",tips:"不能发送空白消息",showTips:!1}},mounted:function(){},created:function(){var t=this;setTimeout((function(){t.scrollTop()}),50)},methods:{sigin:function(){this.$router.push("/signin")},sendMessage:function(){var t=this;console.log(1==this.message,"this.message ==="),this.message.match(/^\s*$/)?(this.showTips=!0,setTimeout((function(){t.showTips=!1}),3e3)):(l.$emit("send",{message:this.message}),setTimeout((function(){t.scrollTop(),t.message="",t.showTips=!1}),50))},watchInput:function(){l.$emit("watchinput",{message:this.message})},scrollTop:function(){this.chatContent=document.querySelector(".message-list"),this.chatContent.scrollTop=this.chatContent.scrollHeight}}},d=u,h=(s("15da"),s("2877")),f=Object(h["a"])(d,i,o,!1,null,null,null),m=f.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"headerbar"},[t.left?s("span",{staticClass:"left"},[t._v(t._s(t.left))]):t._e(),t.title?s("span",{staticClass:"title"},[t._v(t._s(t.title))]):t._e(),s("i",{staticClass:"icon iconfont icon-gengduo more toggle",on:{click:t.toggle}})])},p=[],v={name:"HeaderBar",props:["title","more","left"],data:function(){return{userName:Object(c["e"])()}},methods:{toggle:function(){l.$emit("toggle")}}},E=v,C=(s("9426"),Object(h["a"])(E,g,p,!1,null,null,null)),I=C.exports,b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"list-item"},t._l(t.list,(function(e,a){return s("li",{key:e.messageid,staticClass:"list-item-every",class:{active:t.currentIndex===a},on:{click:function(s){return t.changeMessage(e,a)}}},[s("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:"avator"}}),s("div",{staticClass:"list-item-right"},[s("div",{staticClass:"list-item-header"},[s("span",{staticClass:"title"},[t._v(t._s(e.name))]),s("span",{staticClass:"time"},[t._v(t._s(e.time))])]),s("div",{staticClass:"list-item-content"},[s("span",{staticClass:"text"},[t._v(t._s(e.content))]),s("i",{staticClass:"icon iconfont"})])])])})),0)},O=[],T={name:"ListItem",props:["list"],data:function(){return{currentIndex:0}},methods:{changeMessage:function(t,e){this.currentIndex=e,l.$emit("change",t)}}},R=T,A=(s("d655"),Object(h["a"])(R,b,O,!1,null,null,null)),S=A.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"ManagePanel"},[s("div",{staticClass:"header"},[s("searchbar",{on:{search:t.search}})],1),s("div",{staticClass:"content"},[s("div",{staticClass:"contacts"},[s("div",{staticClass:"contacts-list-wrap"},[s("ul",{staticClass:"contacts-list"},[s("h5",[t._v("在线用户 "+t._s(t.onlineUsers)+" 人")]),t._l(t.list,(function(e){return s("li",{key:e.ID,staticClass:"contacts-list-item",on:{click:function(s){return t.startChat(e)}}},[s("span",{staticClass:"circle",class:{active:"Y"===e.ONLINESTATE}}),s("img",{attrs:{src:e.AVATAR,alt:""}}),s("span",{staticClass:"text",attrs:{title:e.USERNAME}},[t._v(t._s(e.USERNAME))])])}))],2)])]),s("div",{staticClass:"manage-setting"},[s("span",{staticClass:"title"},[t._v("群名")]),s("div",{staticClass:"setting-item"},[s("span",{staticClass:"text",attrs:{contentEditable:"true"}},[t._v(t._s(t.group.GROUPNAME))]),s("i",{staticClass:"icon iconfont icon-xiugai"})])]),s("div",{staticClass:"manage-setting"},[s("span",{staticClass:"title"},[t._v("群公告")]),s("div",{staticClass:"setting-item"},[s("span",{staticClass:"text",attrs:{contentEditable:"true"}},[t._v(t._s(t.group.GROUPREMARK))]),s("i",{staticClass:"icon iconfont icon-xiugai"})])]),s("div",{staticClass:"manage-setting"},[s("span",{staticClass:"title"},[t._v("我在本群的昵称")]),s("div",{staticClass:"setting-item"},[s("span",{staticClass:"text",attrs:{contentEditable:"true"}},[t._v(t._s(t.userName))]),s("i",{staticClass:"icon iconfont icon-xiugai"})])]),s("div",{staticClass:"control"},[s("a",{staticClass:"btn-opacity btn-delete",on:{click:t.deleteExit}},[t._v("删除并退出")])])]),s("div",[s("a-modal",{attrs:{title:"",footer:null,width:"300px"},model:{value:t.chatVisible,callback:function(e){t.chatVisible=e},expression:"chatVisible"}},[s("div",{staticClass:"startchat"},[s("img",{attrs:{src:t.chatInfo.AVATAR,width:"60",height:"60",alt:""}}),s("p",[s("span",[t._v(t._s(t.chatInfo.USERNAME))])]),s("div",{staticStyle:{width:"100%"}},[s("a-button",{attrs:{type:"primary",block:""},on:{click:t.confirmChat}},[t._v("发起聊天")])],1)])])],1)])},M=[],U=(s("4de4"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"searchbar"},[s("i",{staticClass:"icon iconfont icon-sousuo"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"value"}],attrs:{type:"text",placeholder:"搜索"},domProps:{value:t.value},on:{click:t.search,input:function(e){e.target.composing||(t.value=e.target.value)}}})])}),N=[],y={name:"SearchBar",data:function(){return{value:""}},created:function(){},methods:{search:function(){this.$emit("search",{value:this.value})}}},D=y,w=(s("d840"),Object(h["a"])(D,U,N,!1,null,null,null)),x=w.exports,k={name:"ManagePanel",components:{searchbar:x},props:["list","group"],data:function(){return{userName:Object(c["e"])(),chatVisible:!1,chatInfo:{}}},computed:{onlineUsers:function(){var t=this.list.filter((function(t){return"Y"===t.ONLINESTATE}));return t.length}},methods:{search:function(){},deleteExit:function(){l.$emit("exitGroup")},startChat:function(t){t.USERNAME===this.userName?alert("不能向自己发起聊天"):(this.chatVisible=!0,this.chatInfo=t)},confirmChat:function(){this.chatVisible=!1,l.$emit("confirmchat",this.chatInfo)}}},j=k,$=(s("1561"),Object(h["a"])(j,_,M,!1,null,null,null)),G=$.exports,P=s("d800"),V=s("b775");function L(t){return Object(V["a"])({url:"/history/list",method:"get",params:{type:t.type,otherpartid:t.otherpartid}})}var F=s("c20c"),H={name:"chatDetail",components:{chat:m,headerbar:I,listitem:S,managepanel:G,searchbar:x},data:function(){return{title:"",historyChats:[],userName:Object(c["e"])(),newUser:"",online:0,leaveUser:"",count:0,connected:!1,userInfo:{},friendInfo:{},list:[],chatContent:{},groupName:"",groupUsers:[],groupInfo:{},groupVisible:!1,groupConfirmLoading:!1,isOpen:!1}},computed:{},watch:{},mounted:function(){var t=this,e=this;this.$socket.on("connection",(function(){console.log("已经连接")})),this.$socket.on("new message",(function(e){var s="".concat(e.message.FROMUSERID,"对大家说:"),a="".concat(e.message.CONTENT),n=e.message["AVATAR"],i={MESSAGEID:e.message.MESSAGEID,GROUPID:e.message.GROUPID,FROMUSERID:e.message.USERID,TOUSERID:e.message.TOUSERID,CONTENT:e.message.CONTENT,TIME:e.message.TIME,TS:e.message.TS,AVATAR:e.message.AVATAR,USERNAME:e.message.USERNAME};t.getMessageList(),i.GROUPID===t.groupInfo.GROUPID&&t.historyChats.push(i),Object(c["f"])(s,n,a),setTimeout((function(){t.scrollTop()}),50)})),this.$socket.on("private",(function(s){"".concat(s.message.FROMUSERID,"对大家说:"),"".concat(s.message.CONTENT),s.message["AVATAR"];var a={MESSAGEID:s.message.MESSAGEID,GROUPID:s.message.GROUPID,FROMUSERID:s.message.FROMUSERID,TOUSERID:s.message.TOUSERID,CONTENT:s.message.CONTENT,TIME:s.message.TIME,TS:s.message.TS,AVATAR:s.message.AVATAR,USERNAME:s.message.USERNAME};t.getMessageList(),""===a.GROUPID&&a.FROMUSERID===e.friendInfo.otherpartid&&(e.historyChats.push(a),setTimeout((function(){e.scrollTop()}),50))})),l.$on("send",this.addChatMessage),l.$on("watchinput",this.watchInput),l.$on("toggle",this.toggle),l.$on("change",this.changeHistroy),l.$on("confirmchat",this.startChat),this.getMessageList()},created:function(){var t=this;document.addEventListener("click",(function(e){var s=document.querySelector(".toggle"),a=document.querySelector(".ManagePanel");s&&!s.contains(e.target)&&(t.isOpen=!1),a&&a.contains(e.target)&&(t.isOpen=!0)}))},beforeDestroy:function(){},methods:{watchInput:function(t){console.log(t,"用户正在输入中")},groupAddModal:function(){this.groupVisible=!0},groupInfoAdd:function(){var t=this;this.groupInfo={GROUPID:"",GROUPNAME:this.groupName,GROUPREMARK:"",CREATEUSERID:this.userInfo.USERID,CREATETIME:Object(c["a"])("yyyy-MM-dd hh:mm:ss"),DISSOLUTIONTIME:"",GROUPSTATE:"0"},Object(P["d"])({groupInfo:this.groupInfo}).then((function(e){"0"===e.code&&(t.$message.info(e.message),t.groupVisible=!1)}))},groupCancel:function(t){this.groupVisible=!1},changeHistroy:function(t){var e=this;this.friendInfo=t,L(t).then((function(t){"0"===t.code&&(e.historyChats=t["data"],setTimeout((function(){e.scrollTop()}),0))})),"QL"===t.type?(Object(P["a"])(t.otherpartid).then((function(t){"0"===t.code&&(e.groupInfo=t.data,e.title=t.data.GROUPNAME)})),Object(P["c"])(t.otherpartid).then((function(t){"0"===t.code&&(e.groupUsers=t.data)}))):(this.groupInfo.GROUPID="",Object(F["c"])({USERID:t.otherpartid}).then((function(t){"0"===t.code&&(e.title=t.data.USERNAME)})))},getMessageList:function(){var t=this;Object(c["d"])().then((function(e){var s=e?e["USERID"]:null;Object(P["f"])(s).then((function(e){if("0"===e.code){e["data"];return t.list=e["data"],0===t.count&&(t.changeHistroy(t.list[0]),t.count++),Object(c["d"])().then((function(e){t.userInfo=e,t.userInfo&&t.$socket.emit("add user",t.userInfo.USERNAME)})),t.list}})).catch((function(t){console.error(t)}))}))},toggle:function(){this.isOpen=!this.isOpen,document.body.removeEventListener("click",this.toggle)},scrollTop:function(){this.chatContent=document.querySelector(".message-list"),this.chatContent.scrollTop=this.chatContent.scrollHeight},startChat:function(t){var e=this,s={MESSAGEID:"",GROUPID:"",FROMUSERID:this.userInfo.USERID,TOUSERID:t.USERID,CONTENT:"",TIME:Object(c["a"])("yyyy-MM-dd hh:mm"),TS:""};Object(P["e"])(s).then((function(t){"0"===t.code&&(e.messageList(),console.log("发起聊天成功"))}))},addChatMessage:function(t){var e=this;if(t){var s={MESSAGEID:"",GROUPID:this.groupInfo.GROUPID,FROMUSERID:this.userInfo.USERID,TOUSERID:"",CONTENT:t.message,TIME:Object(c["a"])("yyyy-MM-dd hh:mm"),TS:Object(c["b"])(),AVATAR:this.userInfo.AVATAR,USERNAME:this.userInfo.USERNAME};""!==this.groupInfo.GROUPID?this.$socket.emit("new message",s):(s.TOUSERID=this.friendInfo.otherpartid,this.historyChats.push(s),setTimeout((function(){e.scrollTop()}),50),this.$socket.emit("private",s))}}}},q=H,B=(s("e445"),Object(h["a"])(q,a,n,!1,null,null,null));e["default"]=B.exports}}]);